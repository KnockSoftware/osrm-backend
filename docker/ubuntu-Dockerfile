FROM ubuntu:16.04
VOLUME /build

RUN DEBIAN_FRONTEND=noninteractive apt-get -yy update && apt-get -yy install -yy curl cmake build-essential git cmake pkg-config \
  libbz2-dev libxml2-dev libzip-dev libboost-all-dev \
  lua5.2 liblua5.2-dev libtbb-dev

RUN DEBIAN_FRONTEND=noninteractive curl -sL https://deb.nodesource.com/setup_8.x | bash - && \
  apt-get install -y nodejs

COPY . /src
WORKDIR /src

# Install pre-reqs for building node bindings
RUN npm install --ignore-scripts

# Build & install osrm with node bindings
RUN mkdir -p build && cd build && cmake /src -DCMAKE_BUILD_TYPE=Release -DENABLE_NODE_BINDINGS=On && cmake --build . -- -j4 && cmake --build . --target install
RUN npm link

CMD /bin/bash


